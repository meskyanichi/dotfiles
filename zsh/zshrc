# General

autoload -Uz compinit && compinit
zstyle ':completion:*' matcher-list 'm:{a-zA-Z}={A-Za-z}'
setopt auto_cd
HISTFILE=~/.zsh_history
HISTSIZE=1000
SAVEHIST=1000
setopt SHARE_HISTORY
setopt HIST_IGNORE_ALL_DUPS
setopt HIST_IGNORE_SPACE
export PROMPT="%~ # "

# Aliases

alias reload="source $HOME/.zshrc"
alias flushcache="sudo killall -HUP mDNSResponder"

# Security Key (Yubikey)

alias key-kill="gpg-connect-agent 'scd serialno' 'learn --force' /bye"
alias key-set-touch-aut="ykman openpgp keys set-touch aut"
alias key-set-touch-sig="ykman openpgp keys set-touch sig"
alias key-set-touch-enc="ykman openpgp keys set-touch enc"

function key-set-touch() {
    echo "Enter admin pin:"
    read -s pin
    echo "$pin\ny\n" | key-set-touch-sig $1 || return
    echo
    echo "$pin\ny\n" | key-set-touch-enc $1 || return
    echo
    echo "$pin\ny\n" | key-set-touch-aut $1 || return
    echo
    ykman openpgp info
}

# Emacs

if [ -f "/Applications/Emacs.app/Contents/MacOS/Emacs" ]; then
  export EMACS="/Applications/Emacs.app/Contents/MacOS/Emacs"
  alias emacs="$EMACS -nw"
fi

if [ -f "/Applications/Emacs.app/Contents/MacOS/bin/emacsclient" ]; then
  alias emacsclient="/Applications/Emacs.app/Contents/MacOS/bin/emacsclient"
fi

# Local zsh configuration

[ -s ~/.zshrc.local ] && source ~/.zshrc.local
