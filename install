#! /bin/bash

ssh_dir=$HOME/.ssh
dev_dir=$HOME/Developer
dotfiles_dir=$HOME/dotfiles
homebrew_url=https://raw.githubusercontent.com/Homebrew/install/master/install
spacemacs_url=https://github.com/syl20bnr/spacemacs
font=FiraMono-Regular.ttf

echo "Installing XCode command-line tools"
xcode-select --install

echo "Installing Homebrew"
/usr/bin/ruby -e "$(curl -fsSL $homebrew_url)"

echo "Tapping into caskroom/cask and caskroom/fonts"
brew tap caskroom/cask
brew tap caskroom/fonts

echo "Installing latest Git version"
brew install git

if [ ! -d "$HOME/dotfiles" ]; then
  echo "Downloading dotfiles"
  git clone https://github.com/mrrooijen/dotfiles $HOME/dotfiles
fi

echo "Symlinking all configuration and asset files"
ln -nfs "$dotfiles_dir/emacs/spacemacs"  "$HOME/.spacemacs"
ln -nfs "$dotfiles_dir/zsh/zshrc"        "$HOME/.zshrc"
ln -nfs "$dotfiles_dir/zsh/zshenv"       "$HOME/.zshenv"
ln -nfs "$dotfiles_dir/git/gitconfig"    "$HOME/.gitconfig"
ln -nfs "$dotfiles_dir/ruby/gemrc"       "$HOME/.gemrc"
ln -nfs "$dotfiles_dir/fonts/$font"      "$HOME/Library/Fonts/$font"

echo "Ensuring that the ssh directory exists with appropriate permissions"
mkdir -p $ssh_dir
chmod 700 $ssh_dir
chmod 600 $ssh_dir/*

echo "Ensuring that the $HOME/Developer directory exists"
mkdir -p $dev_dir/Go

echo "Installing Zsh"
brew install zsh
touch $HOME/.zshe

echo "Installing iTerm2"
brew cask install iterm2

echo "Installing Emacs"
brew cask install emacs

if [ ! -d "$HOME/.emacs.d" ]; then
  echo "Downloading Spacemacs (for Emacs)"
  git clone $spacemacs_url $HOME/.emacs.d
fi

echo "Installing Docker"
brew cask install docker

echo "Done"
