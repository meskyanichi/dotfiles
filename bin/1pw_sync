#! /bin/sh

me=`whoami`
code=$1
src="/Users/$me/Library/Group Containers/$code.com.agilebits/Library/Application Support/1Password/Backups/"
dst="/Users/$me/Documents/Backups/1Password/"

if [ -z "$code" ]; then
    echo
    echo "Usage:"
    echo
    echo "  1pw_sync <code>"
    echo
    echo "Example:"
    echo
    echo "  1pw_sync 1KS1BL8Z3Q"
    echo
    echo "Find the code in:"
    echo
    echo "  /Users/$me/Library/Group Containers/<code>.com.agilebits/Library/Application Support/1Password/Backups/"
    echo
    echo "Add to crontab ($ crontab -e)"
    echo
    echo "  * * * * * /Users/$me/.dotfiles/bin/1pw_sync <code> >/tmp/1pw_sync.log 2>/tmp/1pw_sync.log"
    echo
    exit 1
fi

if [ ! -d "$src" ]; then
   echo
   echo "No such path: $src"
   echo "Code might be wrong: $code"
   echo
   exit 1
fi

/usr/bin/rsync -av "$src" "$dst"
